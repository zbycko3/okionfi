/* Deep Tracker (c) v3.0.17 */

"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(){var SESSION_ATTR="deepbi_user_session",SESSION_STATUS={active:"active",expired:"expired"},SESSION_EXPIRES=18e5,EVENT_PAGE_PING="page-ping",EVENT_PAGE_OPEN="page-open",SESSION_REFERRER="deepbi_user_referrer",COMPLEX_DOMAINS=["com.pl"],SessionManager=function(){function e(t){_classCallCheck(this,e),this.window=t,this.requestData=null,this.status=null,this.eventSeq=0}return _createClass(e,[{key:"getRequestDataValue",value:function(e){return getObjValue(e,this.requestData)}},{key:"isPagePingEvent",value:function(){return this.getRequestDataValue("event.type")===EVENT_PAGE_PING}},{key:"isPageOpenEvent",value:function(){return this.getRequestDataValue("event.type")===EVENT_PAGE_OPEN}},{key:"isNewCampaign",value:function(){var e,t,n=!1;return this.isPageOpenEvent()&&(e=this.getRequestDataValue("page.domain"),(t=this.getRequestDataValue("referrer.domain"))&&(n=e!==t)),n}},{key:"incrementEventSeq",value:function(){return this.eventSeq++}},{key:"getStatus",value:function(){return this.status}},{key:"isExpired",value:function(){return!Cookies.get(SESSION_ATTR)}},{key:"getId",value:function(){return Cookies.get(SESSION_ATTR).split("|")[0]}},{key:"getLastPageData",value:function(){return this.getRequestDataValue("page")}},{key:"getReferrer",value:function(){return JSON.parse(Cookies.get(SESSION_REFERRER))}},{key:"getData",value:function(e){this.requestData=e,this.refresh();var t={session:{eventseq:this.incrementEventSeq(),status:this.getStatus()}};return this.isExpired()||safeExtend(t.session,{id:this.getId(),lastvisitedpage:this.getLastPageData(),referrer:this.getReferrer()}),t}},{key:"setStatus",value:function(e){this.status=e}},{key:"getEventSeq",value:function(){return this.eventSeq}},{key:"getExpiryTime",value:function(){return new Date((new Date).getTime()+SESSION_EXPIRES)}},{key:"getCurrentDomain",value:function(){var e=this.getRequestDataValue("page.domain"),t=this.getRequestDataValue("page.hostname")||this.window.location.hostname;if(COMPLEX_DOMAINS&&COMPLEX_DOMAINS.indexOf(e)>=0){var n=t.split("."),i=n.length;return i>=3?n[i-3]+"."+n[i-2]+"."+n[i-1]:e}return e}},{key:"create",value:function(e){e=e||uuid(),this.setStatus(SESSION_STATUS.active),Cookies.set(SESSION_ATTR,e+"|"+this.getEventSeq(),{expires:this.getExpiryTime(),domain:this.getCurrentDomain()}),Cookies.set(SESSION_REFERRER,JSON.stringify(this.requestData.referrer),{expires:this.getExpiryTime(),domain:this.getCurrentDomain()})}},{key:"isIdle",value:function(){var e=this.getRequestDataValue("user.attention.active");return this.isPagePingEvent()&&0===e}},{key:"new",value:function(){this.eventSeq=0,this.create()}},{key:"continue",value:function(){var e=Cookies.get(SESSION_ATTR)||"";(e=e.split("|"))[1]&&(this.eventSeq=parseInt(e[1],10)+1),this.create(e[0])}},{key:"refresh",value:function(){this.isIdle()?this.isExpired()&&this.setStatus(SESSION_STATUS.expired):this.isExpired()||this.isNewCampaign()?this.new():this.continue()}}]),e}(),DEEP_DATA_COLLECTION_MIN_LENGTH=2,DEEP_DATA_COLLECTION_FREQUENCY=3e3,DeepDataCollector=function(){function e(t,n){_classCallCheck(this,e),this.window=t,this.tracker=n,this.enabled=(this.tracker.options||{}).dataCollector,this.collectedData={},this.initDeepDataCollector()}return _createClass(e,[{key:"initDeepDataCollector",value:function(){var e=this;this.enabled&&(this.collectData(),setInterval(function(){e.collectData()},DEEP_DATA_COLLECTION_FREQUENCY))}},{key:"getElements",value:function(e,t){var n=this.window.Sizzle,i=e.querySelectorAll;return!isFunction(i)&&n&&(i=function(t){return n(t,e)}),function t(n){var r=[];return isString(n)?r=toArray(i.call(e,n)):isArray(n)&&(r=flatMap(n,t)),r}(t)}},{key:"extractCollections",value:function(e){var t=this;e.replace(/(\r\n\t|\n|\r\t)/gm,"").split(";").filter(function(e){return e&&e.length>DEEP_DATA_COLLECTION_MIN_LENGTH}).forEach(function(e){var n=e.split("=");if(Array.isArray(n)&&2===n.length){var i=n[0]?n[0].replace(/\s/g,""):null;i&&(t.collectedData[i]=JSON.parse(n[1]))}})}},{key:"collectData",value:function(){var t=this;eachDocumentAndIframes(function(n,i){each(t.getElements(n,e.collectionDataSelect),function(e){"script"===e.nodeName.toLowerCase()&&t.extractCollections(e.innerHTML)})})}},{key:"getCollectedData",value:function(){return this.collectedData}}],[{key:"collectionDataSelect",get:function(){return $w(".DeepDataCollection")}}]),e}(),DEEP_MEDIA_STREAM_EVENTS=$w("abort ended error playing pause seeked timeupdate"),DEEP_MEDIA_STREAM_PLAIN_MEDIA_PROPERTIES=$w("crossOrigin currentSrc currentTime defaultPlaybackRate duration error mediaGroup playbackRate preload volume"),DEEP_MEDIA_STREAM_BOOLEAN_MEDIA_PROPERTIES=$w("autoplay controls defaultMuted ended loop muted paused seeking"),DEEP_MEDIA_STREAM_PLAIN_VIDEO_PROPERTIES=$w("poster width height videoWidth videoHeight"),DeepMediaStream=function(){function e(t,n){_classCallCheck(this,e),this.window=t,this.tracker=n,this.media=(this.tracker.options||{}).media,this.mediaListeners=[],this.initDeepMediaStream()}return _createClass(e,[{key:"initDeepMediaStream",value:function(){var e=this;this.media&&(this.setGroups(),this.setupGroupsStream(),isObject(this.media)&&this.media.static||setInterval(function(){e.setupGroupsStream()},2e3))}},{key:"setGroups",value:function(){isString(this.media)&&this.media.length>0?this.groups=[{select:this.media,events:DEEP_MEDIA_STREAM_EVENTS}]:isArray(this.media)?this.groups=map(this.media,function(t){return isString(t)&&t.length>0?{select:t,events:DEEP_MEDIA_STREAM_EVENTS}:isObject(t)&&(t.select||t.events)?safeExtend({select:e.defaultSelect,events:DEEP_MEDIA_STREAM_EVENTS},t):void 0}):isObject(this.media)?this.groups=[safeExtend({select:e.defaultSelect,events:DEEP_MEDIA_STREAM_EVENTS},this.media)]:this.groups=[{select:e.defaultSelect,events:DEEP_MEDIA_STREAM_EVENTS}]}},{key:"setupGroupsStream",value:function(){var t=this;eachDocumentAndIframes(function(n,i){each(t.groups,function(r){var a=t.getMediaElements(n,r.select),o=r.events;isString(o)&&(o=$w(o)),each(a,function(n){var a=n.nodeName.toLowerCase();"video"!==a&&"audio"!==a||e.setMediaListener(r,n)&&t.setupMediaEvents(n,a,o,i)})})})}},{key:"getMediaElements",value:function(e,t){var n=this.window.Sizzle,i=e.querySelectorAll;return!isFunction(i)&&n&&(i=function(t){return n(t,e)}),function t(n){var r=[];return isString(n)?r=toArray(i.call(e,n)):isArray(n)&&(r=flatMap(n,t)),r}(t)}},{key:"setupMediaEvents",value:function(e,t,n,i){var r=this,a=getData(e),o=nowTime(),s=o-1e4,c=0,l=!e.paused,u=!1;each(n,function(n){if(isString(n)){var d=t+"-"+n,p=0;addEvent(e,n,function(){var f,h=nowTime();if("playing"===n&&(u=!0),l&&"timeupdate"===n||0!==c){var m=h-o;if(m>0&&(c+=m),o=h,"timeupdate"===n&&h-s<15e3)return;s=h,f={playingtime:c/1e3},c=0}else if(o=h,"timeupdate"===n)return;l=!e.paused,!u&&"timeupdate"===n&&0===p&&l&&0!==e.currentTime&&r.tracker.event(addIframeAttributes(i,r.enrichMediaEvent(e,{event:{type:t+"-playing",seq:1}},t,a,{playingtime:0}))),r.tracker.event(addIframeAttributes(i,r.enrichMediaEvent(e,{event:{type:d,seq:++p,timestamp:h}},t,a,f)))})}})}},{key:"enrichMediaEvent",value:function(e,t,n,i,r){var a=t[n]=create(null);e.id&&(a.id=e.id);var o=DEEP_MEDIA_STREAM_PLAIN_MEDIA_PROPERTIES;return"video"==n&&(o=o.concat(DEEP_MEDIA_STREAM_PLAIN_VIDEO_PROPERTIES)),each(o,function(t){var n=e[t];isNullOrUndefined(n)||!isNumber(n)&&!(n=(""+n).trim())||(a[t.toLowerCase()]=n)}),each(DEEP_MEDIA_STREAM_BOOLEAN_MEDIA_PROPERTIES,function(t){var n=e[t];isNullOrUndefined(n)||(a[t.toLowerCase()]=!!n)}),this.addMediaSources(e,a),r&&safeExtend(a,r),deepExtend(a,i),t}},{key:"addMediaSources",value:function(e,t){var n={},i=e.getAttribute("src");i=i&&isString(i)?[i]:[],each(e.getElementsByTagName("source"),function(t,r){var a=e.getAttribute("src");a&&isString(a)&&(i.push(a),n[r]={src:a,type:e.type})}),i.length>0&&(t.src=i.length>1?i:i[0]),isEmpty(n)||(t.sources=n)}}],[{key:"setMediaListener",value:function(e,t){return Array.isArray(e.mediaListeners)||(e.mediaListeners=[]),!e.mediaListeners.includes(t)&&e.mediaListeners.push(t)}},{key:"defaultSelect",get:function(){return $w("audio video")}}]),e}(),DEEPBI_USER_DEEPCOOKIE="deepbi_user_deepcookie",DeepTracker=function(){function e(t){_classCallCheck(this,e),this.initialized=!1,this.window=t,this.deepcookie="",this.scoringTypes=["score","level","profile"],this.scoring={},this._initializationDate=new Date,this.trackers={},this.triggers={},this.errors=[],this.mediaStreams={}}return _createClass(e,[{key:"_createAppender",value:function(e,t,n,i,r){var a=this,o=Object.freeze,s=function(s){o&&"object"==(void 0===s?"undefined":_typeof(s))&&null!==s&&o(s);var c=n.push(s),l=a.triggers[i];if(l)for(var u=0;u<l.length;++u)l[u](t,s,e[5],c);return r};return r||(r=s),s}},{key:"addError",value:function(e){this.errors.push([new Date,e])}},{key:"hash",value:function(e){function t(){return e}return t}},{key:"each",value:function(e,t){for(var n in t||(t=1),this.trackers)for(var i=this.trackers[n],r=i[t],a=i[5],o=0;o<r.length;++o)e(n,r[o],a,o);(this.triggers[t]||(this.triggers[t]=[])).push(e)}},{key:"forEachStream",value:function(e){for(var t in this.trackers)e(t)}},{key:"getTracker",value:function(e){return this.trackers[e][0]}},{key:"getInitTime",value:function(){return this._initializationDate}},{key:"setDeepcookie",value:function(e,t){this.deepcookie=e,this.deepcookieStream=t,Cookies.set(DEEPBI_USER_DEEPCOOKIE,this.deepcookie,{domain:window.sessionManager.getCurrentDomain()}),this.requestForInitialScore()}},{key:"getDeepcookie",value:function(){return Cookies.get(DEEPBI_USER_DEEPCOOKIE)||this.deepcookie}},{key:"getScore",value:function(e){var t=this;return new Promise(function(n,i){if(!t.deepcookie)return i("Error: deepcookie not found.");if(!t.deepcookieStream)return i("Error: streamKey not found.");var r=e&&e.force,a=e&&e.type?e.type:"score",o=e&&e.hasOwnProperty("id")&&e.id.name&&e.id.value?e.id:{name:"deepcookie",value:t.deepcookie};if(!r&&t.scoring[a]&&t.scoring[a][o.name]&&t.scoring[a][o.name][o.value])return n(t.scoring[a][o.name][o.value]);t.requestForScore({type:a,id:o,force:r}).then(function(e){return n(e)})})}},{key:"parseScoreResponse",value:function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(t){console.log("Error while parsing response from scoring API:",e)}return"object"!==(void 0===e?"undefined":_typeof(e))?null:e}},{key:"requestForInitialScore",value:function(){var e=this;"GF8KGFuj0MDz"===this.deepcookieStream&&this.scoringTypes.forEach(function(t){var n=new XMLHttpRequest;n.open("GET","https://scoring.deep.bi/score/"+e.deepcookieStream+"/"+e.deepcookie+"?id=deepcookie&column="+t,!0),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(e.scoring.hasOwnProperty(t)||(e.scoring[t]={deepcookie:{}}),e.scoring[t].deepcookie[e.deepcookie]=e.parseScoreResponse(n.response))},n.send(null)})}},{key:"requestForScore",value:function(e){var t=this;return new Promise(function(n){var i=new XMLHttpRequest;i.open("GET","https://scoring.deep.bi/score/"+t.deepcookieStream+"/"+e.id.value+"?id="+e.id.name+"&column="+e.type,!0),i.onreadystatechange=function(){4===i.readyState&&200===i.status&&(t.scoring[e.type].hasOwnProperty(e.id.name)||(t.scoring[e.type][e.id.name]={}),t.scoring[e.type][e.id.name][e.id.value]=t.parseScoreResponse(i.response),n(t.scoring[e.type][e.id.name][e.id.value]))},i.send(null)})}},{key:"options",value:function(e){return this.trackers[e][0].options}},{key:"track",value:function(e,t,n){var i,r,a,o,s,c,l=this.trackers[e];return l?(i=l[0],t&&(l[5]=t)):(this.trackers[e]=l=[0,r=[],a=[],o=[],s=[],t,c=[]],l[0]=i=this._createAppender(l,e,r,1),i.event=this._createAppender(l,e,a,2,i),i.transform=this._createAppender(l,e,o,3,i),i.newpage=this._createAppender(l,e,s,4,i),i.hash=this.hash,i.options=n||{},i.addElements=this._createAppender(l,e,c,6,i)),i}},{key:"enableErrorReporting",value:function(){var e=this;this.window.addEventListener("error",function(t){e.addError([new Date,t])},!0),this.errorReporting=!0}},{key:"testErrorReporting",value:function(){this.window.dispatchEvent(new Event("error"))}},{key:"initialize",value:function(){this.initialized=!0}},{key:"isInitialized",value:function(){return this.initialized}},{key:"createMediaStream",value:function(e){var t=this.getTracker(e);this.mediaStreams[e]=new DeepMediaStream(this.window,t)}},{key:"collectData",value:function(e){var t=this.getTracker(e);this.deepDataCollector=new DeepDataCollector(this.window,t)}},{key:"applyCollectedData",value:function(e){e&&e.event&&(e.event.collectedData=this.deepDataCollector.getCollectedData())}},{key:"initTime",get:function(){return this._initializationDate}}]),e}();window.deepTracker=window.deepTracker||new DeepTracker(window),window.sessionManager=new SessionManager(window),window.deepTracker.enableErrorReporting();var create=isFunction(Object.create)?Object.create:function(){return{}},nowTime=isFunction(Date.now)?Date.now:function(){return(new Date).getTime()},utcOffset=-(new Date).getTimezoneOffset(),max=Math.max,min=Math.min,toString={}.toString;function $w(e){var t=e?e.trim().split(/\s+/):[];return t[0]?t:[]}function isPlainObject(e){return"[object Object]"===toString.call(e)}var isArray=isFunction(Array.isArray)?Array.isArray:function(e){return"[object Array]"===toString.call(e)};function isObject(e){return null!==e&&"object"===(void 0===e?"undefined":_typeof(e))}function isFunction(e){return"function"==typeof e}function isBoolean(e){return"boolean"==typeof e}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isUndefined(e){return void 0===e}function isEmpty(e){if(isArray(e)||isString(e))return 0===e.length;if(isObject(e)){for(var t in e)return!1;return!0}return!isFunction(e)}function charCodeAt(e,t){return e.charCodeAt(t||0)}function charAt(e,t){return e.charAt(t||0)}function each(e,t){for(var n=Object(e),i=n.length>>>0,r=0;r<i;++r)r in n&&t(n[r],r,n)}function map(e,t){var n=Object(e),i=new Array(n.length>>>0);return each(n,function(e,n,r){i[n]=t(e,n,r)}),i}function toArray(e){return map(e,function(e){return e})}function every(e,t){for(var n=Object(e),i=n.length>>>0,r=0;r<i;++r)if(r in n&&!t(n[r],r,n))return!1;return!0}function reduce(e,t){var n,i=Object(e),r=i.length>>>0,a=0;if(3==arguments.length)n=arguments[2];else{for(;!(a in i);++a)if(a>=r)return;n=i[a++]}for(;a<r;a++)a in i&&(n=t(n,i[a],a,i));return n}function flatMap(e,t){return reduce(map(e,t),function(e,t){return e.concat(t)},[])}var hasOwnProperty={}.hasOwnProperty||function(e){return e in this};function safeExtend(e,t){for(var n in t)hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}function shallowClone(e){return safeExtend(create(null),e)}function deepAssign(e,t,n){if(isString(t)){for(var i=t.split("."),r=0,a=i.length-1;r<a;++r){var o=e[t=i[r]];e=isPlainObject(o)?o:e[t]=create(null)}t=i[a]}isArray(n)?deepExtendArray(e[t]=[],n):isPlainObject(n)?isPlainObject(o=e[t])?deepExtend(o,n,deepAssign):deepExtend(e[t]=create(null),n,deepAssign):isObject(n)?isFunction(n.toJSON)&&deepAssign(e,t,n.toJSON()):e[t]=n}function deepAssignNoOverwrite(e,t,n){if(isString(t)){for(var i=t.split("."),r=0,a=i.length-1;r<a;++r){var o=e[t=i[r]];if(isPlainObject(o))e=o;else{if(!isUndefined(o))return;e=e[t]=create(null)}}t=i[a]}o=e[t],isArray(n)?isUndefined(o)&&deepExtendArray(e[t]=[],n):isPlainObject(n)?isUndefined(o)?deepExtend(e[t]=create(null),n,deepAssign):isPlainObject(o)&&deepExtend(o,n,deepAssignNoOverwrite):isObject(n)?isFunction(n.toJSON)&&deepAssignNoOverwrite(e,t,n.toJSON()):isUndefined(o)&&(e[t]=n)}function deepExtendArray(e,t){for(var n=e.length=t.length;n-- >0;)n in t&&deepAssign(e,n,t[n]);return e}function deepExtend(e,t,n){for(var i in n||(n=deepAssign),t)hasOwnProperty.call(t,i)&&n(e,i,t[i]);return e}function deepClone(e){return deepExtend(create(null),e)}function deepGetProperty(e,t){for(var n=0,i=t.length;n<i;e=e[t[n++]])if(!isObject(e))return;return e}var dimensionReplacer=/[^a-zA-Z0-9.$_-]/g;function fixDimensionNames(e,t){if(t||(t=0),isArray(e))e=map(e,function(e){return fixDimensionNames(e,t)});else if(isPlainObject(e)){var n,i,r={};for(n in e)(i=t+n.length)<=64&&hasOwnProperty.call(e,n)&&(r[n.replace(dimensionReplacer,"_")]=fixDimensionNames(e[n],i+1));e=r}return e}function getObjValue(e,t){return t=t||window,reduce(e.split("."),function(e,t){return void 0===e?e:e[t]},t)}function uuid(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,uuid)}var DOMAIN_CONFIG=[{api_url:"vhsrwd.aip24.pl",domains:["naszemiasto.pl","echodnia.eu","telemagazyn.pl","pomorska.pl","gazetawroclawska.pl","dziennikzachodni.pl","gazetakrakowska.pl","poranny.pl","nowiny24.pl","gloswielkopolski.pl","kurierlubelski.pl","gazetalubuska.pl","gk24.pl","gp24.pl","nto.pl","dzienniklodzki.pl","wspolczesna.pl","expressilustrowany.pl","gs24.pl","dziennikbaltycki.pl","expressbydgoski.pl","dziennikpolski24.pl","polskatimes.pl","gol24.pl","strefabiznesu.pl","nowosci.com.pl","sportowy24.pl","motofakty.pl","to.com.pl","regiodom.pl","e-ogrodek.pl","forumbudowlane.pl","e-instalacje.pl","e-dach.pl","e-mieszkanie.pl","e-sciany.pl","demaskator24.pl","e-lazienki.pl","stronazdrowia.pl","e-aranzacje.pl","e-izolacje.pl","e-okna.pl","e-projekty.pl","urzadzone.pl","forumogrodowe.pl","budzetalert.pl","regiopraca.pl","alegratka.pl","e-bezposrednio.pl","e-budownictwo.pl","e-budownictwotv.pl","glos.tv","gra.pl","jarmark.com.pl","juniorfutbol.pl","juniormedia.pl","kredytybudowlane.pl","miastakobiet.pl","mieszkaniezaczytanie.pl","naszahistoria.pl","ekstramagazyn.pl","strefaagro.pl","naszekomunikaty.pl","nekrologi.net","prasa24.pl","sandecja.pl","swieta24.pl","tygodnikits.pl","grdev.pl","stronakobiet.pl","grrc.pl","polskapress.pl","widermobile.pl","gratka.pl"]}];function matchHostname(e,t){return e[e.length-1]===t[t.length-1]&&e[e.length-2]===t[t.length-2]}function getApiUrl(){var e="api.deep.bi",t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||window.location.hostname||window.location.host;if(!t)return e;var n=t.split(".");return n.length<2?e:(DOMAIN_CONFIG.forEach(function(t){Array.isArray(t.domains)&&t.domains.forEach(function(i){if(matchHostname(i.split("."),n))return e=t.api_url})}),e)}var decodeURIComponentQS=decodeURIComponent;function querystringParse(e,t,n){t=t||"&",n=n||"=";var i={};if(!isString(e)||!e)return i;for(var r=/\+/g,a=(e=e.split(t)).length,o=0;o<a;++o){var s,c,l,u,d=e[o].replace(r,"%20"),p=d.indexOf(n);p>=0?(s=d.substr(0,p),c=d.substr(p+1)):(s=d,c=""),l=decodeURIComponentQS(s),u=decodeURIComponentQS(c),hasOwnProperty.call(i,l)?isArray(i[l])?i[l].push(u):i[l]=[i[l],u]:i[l]=u}return i}var ALLOWED_QUERY_PARAMS=$w("utm_source utm_medium utm_campaign utm_term utm_content ref src page promo smclient");function locationSearchToQuery(e){var t=e.search;if(isString(t)&&"?"===t.substr(0,1)){var n={},i=querystringParse(t.substr(1));if(each(ALLOWED_QUERY_PARAMS,function(e){hasOwnProperty.call(i,e)&&(n[e]=i[e])}),!isEmpty(n))return n}}var CREATE_ELEMENT="createElement",GET_ELEMENTS_BY_TAG_NAME="getElementsByTagName",APPEND_CHILD="appendChild",LOCATION="location",HEAD="head",IFRAME="iframe",CONTENT_WINDOW="contentWindow",NODE_TYPE="nodeType",doc,current=new Function("return this;")(),win=current.top;try{doc=win.document}catch(e){}void 0===doc&&(win=current,doc=win.document);var performance=win.performance||{};function getText(e){for(var t,n="",i=0;e[i];++i)3===(t=e[i])[NODE_TYPE]||4===t[NODE_TYPE]?n+=t.nodeValue:8!==t[NODE_TYPE]&&(n+=getText(t.childNodes));return n}function getData(e,t,n){return isUndefined(t)?reduce(e.attributes,function(e,t){var n=(""+t.name).match(/^data-(.+)$/);return n&&(e[n[1].replace(/-/g,".")]=""+t.value),e},create(null)):e.getAttribute("data-"+t)||n}function makeScriptNode(e){var t=doc[CREATE_ELEMENT]("script");return t.type="text/javascript",t.async=!0,t.src="http"+("https:"===doc[LOCATION].protocol?"s:":":")+e,t}function appendHead(e){for(var t;!(t=doc[GET_ELEMENTS_BY_TAG_NAME](HEAD)[0]);)doc[GET_ELEMENTS_BY_TAG_NAME]("html")[0][APPEND_CHILD](doc[CREATE_ELEMENT](HEAD));t[APPEND_CHILD](e)}var cuid=(discreteValues=Math.pow(36,4),pad=function(e,t){var n="000000000"+e;return n.substr(n.length-t)},_globalCount=function(){var e=function(){var e,t=0;for(e in win)t++;return t}();return _globalCount=function(){return e},e},browserPrint=function(){return pad((win.navigator.mimeTypes.length+win.navigator.userAgent.length).toString(36)+_globalCount().toString(36),4)},function(){var e=nowTime().toString(36),t=browserPrint(),n=pad((Math.random()*discreteValues<<0).toString(36),4);return"c"+e+pad(win[LOCATION].href.length.toString(36),2)+t+n}),discreteValues,pad,_globalCount,browserPrint;function parseUrl(e){var t=doc[CREATE_ELEMENT]("div");return t.innerHTML="<a></a>",t.firstChild.href=e,t.innerHTML=t.innerHTML,t.firstChild}var LOCATION_ATTRIBUTES=$w("protocol host hostname port href search hash");function locationAttributes(e,t){var n=create(null);return each(LOCATION_ATTRIBUTES,function(t){n[t]=e[t]}),n.path=e.pathname,t&&(n.domain=domainFromLocation(e)),n.query=locationSearchToQuery(e),n}function domainFromLocation(e){var t=e.hostname;if(!isString(t))return t;if(/^\d+\.\d+\.\d+\.\d+$/.test(t))return t;var n=t.lastIndexOf(".");if(n<0)return t;var i=t.indexOf(".");return i===n?t:t.substr(i+1)}function addEvent(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}function removeEvent(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}function onLoad(e,t){"complete"===e.document.readyState?e.setTimeout(t,150):addEvent(e,"load",t)}var DOM_CONTENT_LOADED="DOMContentLoaded";function onDOMContentLoaded(e,t,n){var i,r,a;function o(){i||(i=!0,r&&e.clearTimeout(r),n(e,t))}if(e===win||t.URL.indexOf("about:"))switch(t.readyState){case"complete":case"interactive":return void o();default:isFunction(t.addEventListener)?addEvent(t,DOM_CONTENT_LOADED,o):(isFunction(t.attachEvent)&&addEvent(t,"readystatechange",function e(){var n=t.readyState;"interactive"!==n&&"complete"!==n||(removeEvent(t,"readystatechange",e),o())}),e===win&&(r=e.setTimeout(function n(){try{t.documentElement.doScroll("left")}catch(t){return void(r=e.setTimeout(n,50))}o()},50)))}else t=null,isFunction((a=e[CONTENT_WINDOW]).addEventListener)&&a.addEventListener(DOM_CONTENT_LOADED,o,!0);addEvent(e,"load",o)}function eachDocumentAndIframes(e){e(doc),eachIframeRecursive(win[LOCATION],doc,e)}function eachIframeRecursive(e,t,n){each(t[GET_ELEMENTS_BY_TAG_NAME](IFRAME),function(t){var i,r;try{r=parseUrl(r=t.src),e.protocol===r.protocol&&e.host===r.host&&(i=findIframeDocument(t))}catch(e){}i&&attachToIframe(t,i,function(i){n(i,t),eachIframeRecursive(e,i,n)})})}function findIframeDocument(e){return e.contentDocument||e[CONTENT_WINDOW].document}function attachToIframe(e,t,n){onDOMContentLoaded(e,t,function(e,t){try{t||(t=findIframeDocument(e))}catch(e){}t&&n(t)})}function addIframeAttributes(e,t){return e&&(t.iframe=locationAttributes(e[CONTENT_WINDOW][LOCATION],1)),t}function encodeUtf8(e){return e.replace(/[\u0080-\u07ff]/g,function(e){return e=charCodeAt(e),String.fromCharCode(192|e>>6,128|63&e)}).replace(/[\u0800-\uffff]/g,function(e){return e=charCodeAt(e),String.fromCharCode(224|e>>12,128|e>>6&63,128|63&e)})}var urlSafeEncodeBase64=(keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",function(e){var t,n,i,r=0,a="";for(e=encodeUtf8(e);r<e.length;)t=charCodeAt(e,r++),n=charCodeAt(e,r++),i=charCodeAt(e,r++),a+=charAt(keyStr,(255&t)>>2)+charAt(keyStr,(3&t)<<4|(255&n)>>4)+(isNaN(n)?"":charAt(keyStr,(15&n)<<2|(255&i)>>6))+(isNaN(i)?"":charAt(keyStr,63&i));return a}),keyStr,hash128=function(){function e(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function t(e,t){return e<<t|e>>>32-t}function n(t){return t=e(t^=t>>>16,2246822507),t=e(t^=t>>>13,3266489909),t^=t>>>16}function i(e){return("00000000"+(e>>>0).toString(16)).slice(-8)}return function(r,a){r=r||"",a=a||0;for(var o=r.length%16,s=r.length-o,c=a,l=a,u=a,d=a,p=0,f=0,h=0,m=0,v=597399067,E=2869860233,g=951274213,y=2716044179,w=0;w<s;w+=16)p=255&charCodeAt(r,w)|(255&charCodeAt(r,w+1))<<8|(255&charCodeAt(r,w+2))<<16|(255&charCodeAt(r,w+3))<<24,f=255&charCodeAt(r,w+4)|(255&charCodeAt(r,w+5))<<8|(255&charCodeAt(r,w+6))<<16|(255&charCodeAt(r,w+7))<<24,h=255&charCodeAt(r,w+8)|(255&charCodeAt(r,w+9))<<8|(255&charCodeAt(r,w+10))<<16|(255&charCodeAt(r,w+11))<<24,m=255&charCodeAt(r,w+12)|(255&charCodeAt(r,w+13))<<8|(255&charCodeAt(r,w+14))<<16|(255&charCodeAt(r,w+15))<<24,c=t(c^=p=e(p=t(p=e(p,v),15),E),19),c=e(c+=l,5)+1444728091,l=t(l^=f=e(f=t(f=e(f,E),16),g),17),l=e(l+=u,5)+197830471,u=t(u^=h=e(h=t(h=e(h,g),17),y),15),u=e(u+=d,5)+2530024501,d=t(d^=m=e(m=t(m=e(m,y),18),v),13),d=e(d+=c,5)+850148119;switch(p=0,f=0,h=0,m=0,o){case 15:m^=charCodeAt(r,w+14)<<16;case 14:m^=charCodeAt(r,w+13)<<8;case 13:d^=m=e(m=t(m=e(m^=charCodeAt(r,w+12),y),18),v);case 12:h^=charCodeAt(r,w+11)<<24;case 11:h^=charCodeAt(r,w+10)<<16;case 10:h^=charCodeAt(r,w+9)<<8;case 9:u^=h=e(h=t(h=e(h^=charCodeAt(r,w+8),g),17),y);case 8:f^=charCodeAt(r,w+7)<<24;case 7:f^=charCodeAt(r,w+6)<<16;case 6:f^=charCodeAt(r,w+5)<<8;case 5:l^=f=e(f=t(f=e(f^=charCodeAt(r,w+4),E),16),g);case 4:p^=charCodeAt(r,w+3)<<24;case 3:p^=charCodeAt(r,w+2)<<16;case 2:p^=charCodeAt(r,w+1)<<8;case 1:c^=p=e(p=t(p=e(p^=charCodeAt(r,w),v),15),E)}return c^=r.length,c+=l^=r.length,c+=u^=r.length,l+=c+=d^=r.length,u+=c,d+=c,c=n(c),c+=l=n(l),c+=u=n(u),l+=c+=d=n(d),u+=c,d+=c,i(c)+i(l)+i(u)+i(d)}}(),jsonParse=isObject(win.JSON)&&isFunction(win.JSON.parse)?win.JSON.parse:function(sJSON){return eval("("+sJSON+")")},stringify=(escMap={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},escFunc=function(e){return escMap[e]||"\\u"+(charCodeAt(e)+65536).toString(16).substr(1)},escRE=/[\\"\u0000-\u001F\u2028\u2029]/g,function(e,t){return function e(t,n,i,r){if((isObject(t)&&!isArray(t)&&!isPlainObject(t)||isFunction(t))&&isFunction(t.toJSON)&&(t=t.toJSON()),isFunction(i)&&(t=i(n,t)),isNull(t))return"null";if(isNumber(t))return isFinite(t)?t.toString():"null";if(isBoolean(t))return t.toString();if(isObject(t)){if(isArray(t)){for(var a="[",o=0;o<t.length;o++)a+=(o?",":"")+e(t[o],""+o,i,"null");return a+"]"}if(isPlainObject(t)){var s,c=[];for(var l in t)hasOwnProperty.call(t,l)&&!isUndefined(s=e(t[l],l,i))&&c.push(e(l)+":"+s);return"{"+c.join(",")+"}"}}else if(isString(t))return'"'+t.replace(escRE,escFunc)+'"';return r}(e,"",t)}),escMap,escFunc,escRE,Cookies;function sendJsonP(e,t,n,i){var r=hookUpGlobal(s),a=makeScriptNode(apiUrl+e+"/events.js?accessKey="+encodeURIComponent(t)+"&cb="+encodeURIComponent(r)+"&b64="+urlSafeEncodeBase64(stringifyAndHash(n)));appendHead(a);var o=win.setTimeout(function(){s(!1)},2e4);function s(e){win.clearTimeout(o);var t=i;r&&delete win[r],i=r=null,t&&t(e);var n=a.parentNode;n&&n.removeChild(a)}}function hookUpGlobal(e){var t;do{t="_deep_bi_"+cuid()}while(t in win);return win[t]=e,t}Cookies=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}return function t(n){function i(t,r,a){var o;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(a=e({path:"/"},i.defaults,a)).expires){var s=new Date;s.setMilliseconds(s.getMilliseconds()+864e5*a.expires),a.expires=s}a.expires=a.expires?a.expires.toUTCString():"";try{o=JSON.stringify(r),/^[\{\[]/.test(o)&&(r=o)}catch(e){}r=n.write?n.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var c="";for(var l in a)a[l]&&(c+="; "+l,!0!==a[l]&&(c+="="+a[l]));return document.cookie=t+"="+r+c}t||(o={});for(var u=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,p=0;p<u.length;p++){var f=u[p].split("="),h=f.slice(1).join("=");this.json||'"'!==h.charAt(0)||(h=h.slice(1,-1));try{var m=f[0].replace(d,decodeURIComponent);if(h=n.read?n.read(h,m):n(h,m)||h.replace(d,decodeURIComponent),this.json)try{h=JSON.parse(h)}catch(e){}if(t===m){o=h;break}t||(o[m]=h)}catch(e){}}return o}}return i.set=i,i.get=function(e){return i.call(i,e)},i.getJSON=function(){return i.apply({json:!0},[].slice.call(arguments))},i.defaults={},i.remove=function(t,n){i(t,"",e(n,{expires:-1}))},i.withConverter=t,i}(function(){})}();var apiUrl="//"+getApiUrl()+"/v1/streams/",XHR=win.XMLHttpRequest,SET_REQUEST_HEADER="setRequestHeader",WITH_CREDENTIALS="withCredentials",sendAjax=function(){var e,t=/[^a-zA-Z0-9_-]+/g;if(useAjax()){var n=function(e,n,i,r,a){var o=new XHR,s=apiUrl+n+"/events";return"GET"===e&&a&&(s+="?deepcookie="+a),o.open(e,s),o[WITH_CREDENTIALS]=!0,o[SET_REQUEST_HEADER]("Authorization","bearer "+String(i).replace(t,"")),o.onreadystatechange=function(){if(4==o.readyState&&r){"GET"===e&&ns.setDeepcookie(o.response,n);var t=o.status;r(200===t||204===t||t),r=null}},o};return function t(i,r,a,o,s){if(a.data&&a.data.elements)if("page-ping"===a.data.event.type){var c=[];if(each(a.data.elements,function(e){var t=deepClone(a.data);delete t.elements,delete t.user.attention,t.event.type=a.data.event.type.replace("page-",""),t.element=e,c.push(t)}),c.length){if("page-ping"===a.data.event.type){var l=deepClone(a.data);delete l.elements,c.unshift(l)}a.data=c}else delete a.data.elements}else"page-open"===a.data.event.type&&delete a.data.elements;if(a.data&&a.data.newElements&&"open"===a.data.event.type){var u=[];delete a.data.elements,each(a.data.newElements,function(e){var t=deepClone(a.data);delete t.newElements,delete t.user.attention,t.event.type=a.data.event.type.replace("page-",""),t.element=e,u.push(t)}),a.data=u}if(a.data&&a.data.event&&"page-ping"!==a.data.event.type&&delete a.data.user.attention,e)if(isArray(e))e.push([i,r,a,o]);else{var d=n("POST",i,r,o);d[SET_REQUEST_HEADER]("Content-Type","application/json"),a.addCookie&&(a.addCookie.set=0),d.send(stringifyAndHash(a))}else e=[],n("GET",i,r,function(n){var s=e;!0!==n?(e=null,o(n),each(s,function(e){e[3](n)})):(e=!0,t(i,r,a,o),each(s,function(e){t.apply(this,e)}))},s).send()}}return sendJsonP}();function useAjax(){try{return void 0!==(new XHR)[WITH_CREDENTIALS]}catch(e){}return!1}var incrementSendAjaxRetryAfter=2e4,maxSendAjaxRetryAfter=500050;function sendAjaxRetryOnError(e,t,n,i){i||(i=50),win.setTimeout(function(){sendAjax(e,t,n(),function(r){!0!==r&&(0==r||!isNumber(r)||r>501)&&i<=maxSendAjaxRetryAfter&&sendAjaxRetryOnError(e,t,n,i+incrementSendAjaxRetryAfter)})},i)}var validatedStreamTracks={},BrowserUtils;function validateAndCall(e,t,n,i){if(!0===validatedStreamTracks[e])return i();win.clearTimeout(validatedStreamTracks[e]);var r=(ns.options(e)||{}).validate;if(!isObject(r))return i();var a,o=r.timeout;isNumber(o)&&isFinite(o)&&(a=n+1e3*o-nowTime()),!(isUndefined(a)||a>=0)||validateDefined(t,r.defined)?(validatedStreamTracks[e]=!0,i()):a>=0&&(validatedStreamTracks[e]=win.setTimeout(validateAndCall,a,e,t,n,i))}function validateDefined(e,t){return!t||(isString(t)&&(t=[t]),!isArray(t)||every(t,function(t){return!t||!isString(t)||void 0!==deepGetProperty(e,t.split("."))}))}!function(e,t){var n=function(){var n=e.pageYOffset||("CSS1Compat"===t.compatMode?t.documentElement.scrollTop:t.body.scrollTop);return Math.round(n)};BrowserUtils={extend:function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]},getDocumentHeight:function(){return Math.round(Math.max(t.documentElement.scrollHeight,t.body.scrollHeight,t.documentElement.offsetHeight,t.body.offsetHeight,t.documentElement.clientHeight))},getElementHeight:function(e){return Math.round(Math.max(e.scrollHeight,e.offsetHeight,e.clientHeight))},getElementsBySelector:function(n){return void 0!==e.jQuery?e.jQuery(n):void 0!==t.querySelectorAll?t.querySelectorAll(n):"#"===n.charAt(0)?t.getElementById(n.substr(1)):void 0},getElementYOffsetToDocumentTop:function(e){return Math.round(e.getBoundingClientRect().top+n())},getPageYOffset:n,getScrollDistance:function(){return BrowserUtils.getPageYOffset()+BrowserUtils.getWindowHeight()},getWindowHeight:function(){return Math.round(e.innerHeight||t.documentElement.clientHeight||t.body.clientHeight)},throttle:function(e,t){var n,i,r,a=null,o=0,s=function(){o=new Date,a=null,r=e.apply(n,i)};return function(){var c=new Date;o||(o=c);var l=t-(c-o);return n=this,i=arguments,l<=0?(clearTimeout(a),a=null,o=c,r=e.apply(n,i)):a||(a=setTimeout(s,l)),r}},isOnScreen:function(t){var n,i,r,a=!1;return t&&(n=e.innerHeight,i=t.getBoundingClientRect().top,r=t.getBoundingClientRect().bottom,a=n>=i&&r>0),a}}}(window,document);var ScrollEventHandler=function(e){var t,n,i,r=!0,a=[];return t=function(e){r&&n(),a.push(e)},i=function(){each(a,function(e){e()})},n=function(){r=!1,addEvent(e,"scroll",BrowserUtils.throttle(i,200))},{onScroll:t}}(window),Marks=(getMarksArray=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},{calculate:calculate=function(e){var t=this,n={},i=e?getMarksArray(e):t.options.marks,r=[];if(isString(i)){var a=parseInt(i,10),o=0;if(isNumber(a))for(;o<=100;)r.push(o+"%"),o+=a}else r=i;each(r,function(e,i,r){var a=parseFloat(r[i]);isNaN(a)||(n[a+"%"]=Math.round(t.el.params.currentOffsetToDocumentTop+t.el.params.currentHeight*(parseFloat(e)/100)))}),this.marks=n},check:function(e){var t=this;for(var n in t.marks&&!DeepElements.updateElementMeasurements(t.el)||calculate.call(this,t.marks),t.marks)t.marks.hasOwnProperty(n)&&e>=t.marks[n]&&(t.sendEvent({mark:parseInt(n,10)+"%",viewabletime:t.el.timer.getMarkTime()}),delete t.marks[n])},marksExists:function(){for(var e in this.marks)if(this.marks.hasOwnProperty(e))return!1;return!0}}),calculate,getMarksArray,ViewTimer=function(e){this.el=e,this.viewabletime=0,this.markTime=0},ScrollDepth,Viewability,Clickability,ClickabilityGlobal;ViewTimer.prototype={getElapsedTime:function(){var e=this.viewabletime;return this.viewabletime=0,e},getMarkTime:function(){var e=this.markTime;return this.markTime=0,e},watch:function(){var e=this;setInterval(function(){!visibly.hidden()&&BrowserUtils.isOnScreen(e.el.domEl)&&(e.viewabletime+=1e3,e.markTime+=1e3)},1e3)}},window.visibly={q:document,p:void 0,prefixes:["webkit","ms","o","moz","khtml"],props:["VisibilityState","visibilitychange","Hidden"],m:["focus","blur"],visibleCallbacks:[],hiddenCallbacks:[],genericCallbacks:[],_callbacks:[],cachedPrefix:"",fn:null,onVisible:function(e){"function"==typeof e&&this.visibleCallbacks.push(e)},onHidden:function(e){"function"==typeof e&&this.hiddenCallbacks.push(e)},getPrefix:function(){if(!this.cachedPrefix)for(var e,t=0;e=this.prefixes[t++];)if(e+this.props[2]in this.q)return this.cachedPrefix=e,this.cachedPrefix},visibilityState:function(){return this._getProp(0)},hidden:function(){return this._getProp(2)},visibilitychange:function(e){"function"==typeof e&&this.genericCallbacks.push(e);var t=this.genericCallbacks.length;if(t)if(this.cachedPrefix)for(;t--;)this.genericCallbacks[t].call(this,this.visibilityState());else for(;t--;)this.genericCallbacks[t].call(this,arguments[0])},isSupported:function(e){return this._getPropName(2)in this.q},_getPropName:function(e){return""==this.cachedPrefix?this.props[e].substring(0,1).toLowerCase()+this.props[e].substring(1):this.cachedPrefix+this.props[e]},_getProp:function(e){return this.q[this._getPropName(e)]},_execute:function(e){if(e){this._callbacks=1==e?this.visibleCallbacks:this.hiddenCallbacks;for(var t=this._callbacks.length;t--;)this._callbacks[t]()}},_visible:function(){window.visibly._execute(1),window.visibly.visibilitychange.call(window.visibly,"visible")},_hidden:function(){window.visibly._execute(2),window.visibly.visibilitychange.call(window.visibly,"hidden")},_nativeSwitch:function(){this[this._getProp(2)?"_hidden":"_visible"]()},_listen:function(){try{this.isSupported()?this.q.addEventListener(this._getPropName(1),function(){window.visibly._nativeSwitch.apply(window.visibly,arguments)},1):this.q.addEventListener?(window.addEventListener(this.m[0],this._visible,1),window.addEventListener(this.m[1],this._hidden,1)):this.q.attachEvent&&(this.q.attachEvent("onfocusin",this._visible),this.q.attachEvent("onfocusout",this._hidden))}catch(e){}},init:function(){this.getPrefix(),this._listen()}},window.visibly.init(),function(){var e={marks:["20%","40%","60%","80%","90%","100%"]},t=function(e,t){this.el=e,this.options=t,this.check()};t.prototype={sendEvent:function(e){DeepElements.sendEvent(this.el,"scrolldepth",e)},check:function(){var e=BrowserUtils.getScrollDistance();Marks.check.call(this,e),isEmpty(this.marks)&&n.removeElement(this.el)}};var n={elements:[],isFirstInit:!0,scrollEventHandler:function(){each(n.elements,function(e){e.check()})},init:function(){n.isFirstInit=!1,ScrollEventHandler.onScroll(n.scrollEventHandler),visibly.visibilitychange(n.scrollEventHandler)},removeElement:function(e){each(n.elements,function(t,i){e.streamKey===t.el.streamKey&&e.selector===t.el.selector&&n.elements.splice(i,1)})},addElement:function(i,r){n.isFirstInit&&n.init(),r=BrowserUtils.extend({},e,r);var a=new t(i,r);n.elements.push(a)}};ScrollDepth={addElement:n.addElement}}(window,document),function(){var e={mark:"50%",time:1e3},t=function(e,t){this.el=e,this.options=t,this.timeout=null,this.timeoutTime=parseInt(t.time,10),this.eventSent=!1,this.isCounting=!1,this.elapsedTime=0,this.startTime=0,this.check()};t.prototype={check:function(){this.isOnScreen()&&!visibly.hidden()?this.startCount():this.stopCount()},startCount:function(){var e=this;this.isCounting||this.eventSent||(this.isCounting=!0,this.startTime=+new Date,this.timeout=setTimeout(function(){e.eventSent=!0,DeepElements.sendEvent(e.el,"viewable",{mark:e.options.mark,time:e.timeoutTime}),n.removeElement(e.el)},this.timeoutTime-this.elapsedTime))},stopCount:function(){this.isCounting&&(this.isCounting=!1,clearTimeout(this.timeout),this.elapsedTime+=+new Date-this.startTime)},isHidden:function(){var e=this.el.domEl,t=!0;return e&&(t=0===e.offsetWidth&&0===e.offsetHeight),t},isOnScreen:function(){var e,t,n,i=!1,r=this.el.domEl;return r&&(i=window.innerHeight>=(e=r.getBoundingClientRect().top)+(n=((t=r.getBoundingClientRect().bottom)-e)*(parseFloat(this.options.mark)/100))&&t>=n),i&&!this.isHidden()}};var n={elements:[],isFirstInit:!0,scrollEventHandler:function(){each(n.elements,function(e){e.check()})},removeElement:function(e){each(n.elements,function(t,i){e.streamKey===t.el.streamKey&&e.selector===t.el.selector&&n.elements.splice(i,1)})},init:function(){n.isFirstInit=!1,ScrollEventHandler.onScroll(n.scrollEventHandler),visibly.visibilitychange(n.scrollEventHandler)},addElement:function(i,r){n.isFirstInit&&n.init(),r=BrowserUtils.extend({},e,r);var a=new t(i,r);n.elements.push(a)}};Viewability={addElement:n.addElement}}(window,document),window,document,ClickabilityGlobal={sendEvent:function(e){DeepElements.sendEvent(e,"click")},bindClick:function(e){e.domEl&&addEvent(e.domEl,"click",BrowserUtils.throttle(function(){ClickabilityGlobal.sendEvent(e)},200))},addElement:function(e){ClickabilityGlobal.bindClick(e)}},Clickability={addElement:ClickabilityGlobal.addElement};var DeepElementsTransformation=(allowedEvents=["open","ping"],updateDeviceData=function(e){e.documentheight=BrowserUtils.getDocumentHeight(),e.viewportheight=BrowserUtils.getWindowHeight()},{checkIfMetaTransformationNeeded:function(e,t){return DeepElements.hasElements(t)&&isAllowToTransformData(e.data.event.type)&&updateDeviceData(e.data.user.device.screen),e},isAllowToTransformData:isAllowToTransformData=function(e){return e=e.replace("page-",""),allowedEvents.indexOf(e)>-1}}),isAllowToTransformData,updateDeviceData,allowedEvents,DeepElements=(registeredElements=[],isLoaded=!1,isRegistered=function(e,t){var n=!1;return each(registeredElements[t],function(t){if(e.selector===t.selector)return n=!0,!1}),n},register=function(e,t,n){var i=null;return e.type&&e.selector&&t&&(n=n||{},e.domEl=document.querySelector(e.selector),e.streamKey=t,registeredElements[t]?isRegistered(e,t)||(registeredElements[t].push(e),bindAnalytics(e,n)):(registeredElements[t]=[e],bindAnalytics(e,n)),i=e),i},getElementDataToSend=function(e){var t={type:e.type,selector:e.selector,params:e.params};return e.details&&(t.details=e.details),t},getElementsDataToSend=function(e){var t=[];return each(registeredElements[e],function(e){var n=getElementDataToSend(e);n.params=BrowserUtils.extend({},n.params,{viewabletime:e.timer.getElapsedTime()}),t.push(n)}),t},isAllowToRun=function(e,t){var n=!1;for(var i in t)t.hasOwnProperty(i)&&(n=e[i]&&e[i]==t[i]);return n},bindAnalytics=function(e,t){e.timer=new ViewTimer(e),e.timer.watch(),e.params={},updateElementMeasurements(e),t.scrolldepth&&!isEmpty(t.scrolldepth.elements)&&each(t.scrolldepth.elements,function(n){if(isAllowToRun(e,n))return ScrollDepth.addElement(e,t.scrolldepth),!1}),t.viewability&&!isEmpty(t.viewability.elements)&&each(t.viewability.elements,function(n){if(isAllowToRun(e,n))return Viewability.addElement(e,t.viewability),!1}),t.click&&!isEmpty(t.click.elements)&&each(t.click.elements,function(n){if(isAllowToRun(e,n))return Clickability.addElement(e,t.click),!1})},sendOpenEvent=function(e,t){var n=ns.track(t),i=[];each(e,function(e){i.push(getElementDataToSend(e))}),n.event({event:{type:"open"},newElements:i})},{init:function(){isLoaded||(isLoaded=!0,ns.forEachStream(function(e){var t=ns.getTracker(e).elements;isArray(t)&&addElements(t,e)}))},addElements:addElements=function(e,t){var n,i=ns.options(t),r=[];each(e,function(e){(n=register(e,t,i))&&r.push(n)}),sendOpenEvent(r,t)},extendData:function(e,t){return DeepElementsTransformation.isAllowToTransformData(e.event.type)&&(e.elements=getElementsDataToSend(t)),e},hasElements:function(e){return!(!registeredElements[e]||!registeredElements[e].length)},sendEvent:function(e,t,n){var i=ns.track(e.streamKey),r=getElementDataToSend(e);r.params=BrowserUtils.extend({},r.params,n),i.event({event:{type:t},element:r})},updateElementMeasurements:updateElementMeasurements=function(e){var t,n,i=!1;return e.domEl&&(t=BrowserUtils.getElementYOffsetToDocumentTop(e.domEl),n=BrowserUtils.getElementHeight(e.domEl),t===e.params.currentOffsetToDocumentTop&&n===e.params.currentHeight||(isNullOrUndefined(e.params.startOffsetToDocumentTop)&&isNullOrUndefined(e.params.startHeight)&&(e.params.startOffsetToDocumentTop=t,e.params.startHeight=n),e.params.currentOffsetToDocumentTop=t,e.params.currentHeight=n,i=!0)),i}}),register,isRegistered,addElements,getElementDataToSend,getElementsDataToSend,updateElementMeasurements,bindAnalytics,isAllowToRun,sendOpenEvent,registeredElements,isLoaded;function addPageDynamicAttributes(e,t,n){var i=win[LOCATION],r=i,a=t.options(n)||{};a.pageCanonical&&(r=fetchCanonicalUrl()||r);var o,s=e.page=isPlainObject(e.page)?shallowClone(e.page):{};a.pageCanonicalPath&&isString(a.pageCanonicalPath)&&(r=parseUrl(a.pageCanonicalPath)),isString(s.path)&&(o=s.path.trim())&&(r=parseUrl(o)),safeExtend(s,locationAttributes(r)),s.domain||(s.domain=domainFromLocation(r)),s.hash||(s.hash=i.hash),safeExtend(e,window.sessionManager.getData(e)),safeExtend(e,DeepElements.extendData(e,n))}var filterMetaBeforeSend=function(e,t,n){var i=(e=shallowClone(e)).data=shallowClone(e.data);i.event=shallowClone(i.event);return addPageDynamicAttributes(i,t,n),i.event.timestamp=max(nowTime()-i.event.timestamp,0),safeExtend(e,DeepElementsTransformation.checkIfMetaTransformationNeeded(e,n)),e},preProcessEventData=function(e,t,n){delete e.page.path,delete e.event.type,delete e.event.timestamp},postProcessEventMeta=function(e,t,n){var i=e.data;delete i.page.loadtime;var r=i.event.timestamp;isNumber(r)&&isFinite(r)||(i.event.timestamp=nowTime());var a=i.event.type;isString(a)&&a||(i.event.type="custom-event"),t.applyCollectedData(i),setupDeepAttentionMeta(e,t,n)},getBrowserDnt=function(){return!!(navigator.doNotTrack||navigator.msDoNotTrack||win.doNotTrack)},postProcessTrackerMeta=function(e,t,n,i,r){var a=e.data,o=(win[LOCATION],doc.referrer);o=o?parseUrl(o):{};var s=win.screen||{},c=s.orientation||s.mozOrientation||s.msOrientation;isObject(c)&&isString(c.type)&&(c=c.type);var l=i,u=t.getInitTime().getTime(),d=l-u,p=performance.timing;p&&(d=p.domInteractive-p.fetchStart),deepExtend(a,{event:{type:"page-open",timestamp:min(l,u),"localtime.utcoffset":utcOffset},user:{device:{browserua:{general:{dnt:getBrowserDnt()}},screen:{width:s.width,height:s.height,availwidth:s.availWidth,availheight:s.availHeight,orientation:isString(c)?c:void 0}},"id.session":cuid()},page:{},referrer:locationAttributes(o,1)});var f=t.options(n)||{},h=a.page.path;isString(h)&&(h=a.page.path.trim())&&(f.pageCanonicalPath=h),d>=0&&(a.page.loadtime=d),a.page.title&&isString(a.page.title)||(a.page.title=fetchTitle()),t.applyCollectedData(a),setupDeepAttentionMeta(e,t,n),initAttention(e,t,n,r)};function setupDeepAttentionMeta(e,t,n){var i=win.navigator||{},r=t.options(n)||{},a=getBrowserDnt(),o=r.trackconsent||r.consent||!1;safeExtend(e,{getEventTime:{field:["event","timestamp"],sub:1},addDeviceHeaders:["user","device","headers"],addRemoteAddress:["user","id","ip"],tran:[{dateSplit:{fromField:["event","timestamp"],toField:["event","localtime"],parts:["date","hour","minute","weekday","weekdayno","utcoffset","week"],utcoffset:["event","localtime","utcoffset"]}},{compact:{}}],enrich:[{ip2location:{fromField:"user.id.ip",toField:"user.location"}},{detectDevice:{fromField:"user.device.headers",toField:"user.device",mode:"merge"}}]}),(!1!==i.cookieEnabled&&!a&&o||r.dntignore)&&safeExtend(e,{addCookie:{field:["user","id","deepcookie"]}}),r.hasOwnProperty("identifyBy")&&r.identifyBy&&safeExtend(e,{identifyBy:r.identifyBy})}function fetchHeadTags(e){var t=doc[GET_ELEMENTS_BY_TAG_NAME](HEAD)[0];return t?t[GET_ELEMENTS_BY_TAG_NAME](e):[]}function fetchCanonicalUrl(){for(var e=fetchHeadTags("link"),t=e.length;t-- >0;)if("canonical"===e[t].rel&&e[t].href)return parseUrl(e[t].href)}function fetchTitle(){var e=fetchHeadTags("title");return e.length?getText(e).trim():""}function initAttention(e,t,n,i){var r=e.data;(e=shallowClone(e)).data=void 0;var a="_dpAttention_unloaded_ MAfdz1HC9XrMEWeQWTeHBCGe."+n,o=5e3,s=15e3,c=192e4,l=144e5,u=1e3,d=5e3,p=1e3,f=s,h=0,m=0,v=0,E=min(nowTime(),r.event.timestamp),g=E+o,y=!0,w=null,S=0;function A(){var i=e.data=shallowClone(r),a=i.event=shallowClone(i.event),o=i.page=shallowClone(i.page);a.type="page-ping",a.timestamp=0;var s=i.user.attention=shallowClone({total:h,active:m,idle:h-m});return a.pingseq=++v,delete o.loadtime,delete o.path,addPageDynamicAttributes(i,t,n),safeExtend(e,DeepElementsTransformation.checkIfMetaTransformationNeeded(e,n)),s}function T(){S=nowTime()+f,w=win.setTimeout(D,f)}function k(){if(w)return win.clearTimeout(w),w=null,S=0,!0}function D(){if(k()){var t=A();i(e,function(e){!0===e&&(h-=t.total,m-=t.active),y?f=s:f<c&&(f+=f),T()})}}var _=null;function C(e){_&&(win.clearTimeout(_),_=null);var t=nowTime(),n=min(max(t-E,0),p);h+=n,t>=g?y&&(E<g&&(m+=min(g-E,p)),y=!1):y?m+=n:(y=!0,f!=s&&S-nowTime()>s&&(f=s,k()&&T())),E=t,e||(_=win.setTimeout(C,100))}function b(){g=nowTime()+o,C()}function O(){y&&(g=nowTime()),C()}var N=doc[GET_ELEMENTS_BY_TAG_NAME]("body")[0];addEvent(win,"focus",b),addEvent(win,"scroll",b),addEvent(win,"resize",b),addEvent(N,"mousemove",b),addEvent(N,"mousedown",b),addEvent(N,"keydown",b),addEvent(win,"blur",O),addEvent(win,"pagehide",O),addEvent(win,"pageshow",b),addEvent(win,"focusin",b),addEvent(win,"focusout",O),addEvent(win,"unload",function(){if(g=nowTime(),C(1),k()&&h>=u&&(v||h>=d)){A(),e.data.event.timestamp=g;try{win.localStorage.setItem(a,stringifyAndHash(e))}catch(e){}}}),function e(){try{var t,n,r=win.localStorage.getItem(a);isString(r)&&r&&(isObject(r=jsonParse(r))&&isObject(t=r.data)&&isObject(t.event)&&isNumber(n=t.event.timestamp)&&isFinite(n)&&(n=nowTime()-n)<l?(t.event.timestamp=max(n,0),i(r,function(t){!0===t?win.localStorage.removeItem(a):win.setTimeout(e,s)})):win.localStorage.removeItem(a))}catch(e){}}(),T(),C()}var ns=window.deepTracker,postProcessTrackerMeta,preProcessEventData,postProcessEventMeta,filterMetaBeforeSend;function stringifyAndHash(e){return stringify(fixDimensionNames(e),function(e,t){if(isFunction(t)&&"hash"===t.name){if(!isString(t=t()))return;t=hash128(encodeUtf8(t),1145390416)}return t})}function prepareErrorEvents(){var e=win.XMLHttpRequest=function(){var e=new XHR;return addEvent(e,"load",function(){e.status>=400&&ns.errors.push([new Date,{status:e.status,message:e.statusText,responseURL:e.responseURL}])}),e};(e.prototype=create(XHR.prototype)).constructor=e;var t=ns.errors,n={};function i(e){for(var t in n){var i=n[t],r=(i[0],i[1],ns.track(t));each(e,function(e){var t=e[0].getTime(),n=e[1],i=n.target,a=i&&i.nodeName;r.event({event:{type:"page-error",timestamp:t},error:{message:n.message,status:n.status,responseurl:n.responseURL,filename:n.filename,lineno:n.lineno,colno:n.colno,target:a&&{nodename:(""+a).toLowerCase(),src:i.src&&""+i.src,href:i.href&&""+i.href}}})})}}ns.each(function(e,t,i){var r=(ns.options(e)||{}).errors;r&&(n[e]||(n[e]=[r,i]))}),isEmpty(n)||(ns.errors={push:function(e){win.setTimeout(i,50,[e])}},i(t))}onDOMContentLoaded(win,doc,function(){if(isObject(ns)&&isFunction(ns.each)&&isFunction(ns.getInitTime)&&isFunction(ns.track)){var e,t=nowTime(),n={},i=[],r={},a={};DeepElements&&DeepElements.init(),ns.each(function(r,a,o){var c=n[r]||(n[r]=[create(null)]),l=create(null);if(isFunction(a)){var u=a(l);a=isPlainObject(u)?u:l}else isUndefined(a)&&(a=l);isString(o)&&(c[1]=o),isPlainObject(a)&&(ns.createMediaStream(r),ns.collectData(r),validateAndCall(r,deepExtend(c[0],a),t,function(){!function(t,n,i){e&&win.clearTimeout(e);e=win.setTimeout(s,50,t,n,i)}(n,i,postProcessTrackerMeta)}))}),ns.each.length>1&&(ns.each(function(e,t){DeepElements.addElements(t,e)},6),ns.each(function(e,t,r){var s=n[e];s&&~i.indexOf(e)?o(s,e,t,r):(a[e]||(a[e]=[])).push([t,r])},2),ns.each(function(e,t){var n=r[e]||[];isArray(t)?every(t,isPlainObject)&&(n=t):isPlainObject(t)&&n.push(t),r[e]=n},3))}function o(e,t,n,i){var r=deepClone(e[0]),a={},o=a[t]=[r,e[1]];if(isFunction(n)){var c=create(null),l=n(c);n=isPlainObject(l)?l:c}isString(i)&&(o[1]=i),isPlainObject(n)&&(isFunction(preProcessEventData)&&preProcessEventData(r,ns,t),deepExtend(r,n,deepAssignNoOverwrite),s(a,null,postProcessEventMeta))}function s(e,n,i){var r=function(){var r=(ns.options(s)||{}).forceDeepcookie?ns.getDeepcookie():null;n&&~n.indexOf(s)||(n&&n.push(s),l=create(null),u=e[s],d=u[1],l.data=u[0],isFunction(i)&&i(l,ns,s,t,function(e,t){return sendAjax(s,d,c(e,s),t,r)}),sendAjaxRetryOnError(s,d,function(){return c(isFunction(filterMetaBeforeSend)?filterMetaBeforeSend(l,ns,s):l,s)}),(p=a[s])&&(delete a[s],each(p,function(e){o(u,s,e[0],e[1])})))};for(var s in e){var l,u,d,p;r()}}function c(e,t){var n=ns.options(t)||{},i=(ns.options(t)||{}).trackconsent||(ns.options(t)||{}).consent||!1,a=r[t];if(a){var o=(e=shallowClone(e)).tran||e.transform||e.transformation;isArray(o)?e.tran=a.concat(o):e.tran=a}e.data.dmascript={version:"3.0.17",releasedate:"2019-07-08",dntignore:n.dntignore},e.data.user.consents={gdpr:i};var s=(ns.options(t)||{}).inject;return s&&"object"===(void 0===s?"undefined":_typeof(s))&&(e.data.inject=Object.assign({},s)),e}}),isArray(ns.errors)&&onLoad(win,prepareErrorEvents);var performanceFields=$w("name startTime"),performanceSelfNameRe=new RegExp("https?://"+getApiUrl()+"/v1/streams/[^/]+/events");function preparePerformanceEvents(){var e=nowTime(),t={};if(ns.each(function(e,n,i){var r=(ns.options(e)||{}).performance;r&&(t[e]||(t[e]=[r,i]))}),!isEmpty(t)){var n=performance.getEntriesByType("resource");for(var i in t){var r=t[i],a=r[0],o=(r[1],ns.track(i));each(c(a),function(t){var n;!t.initiatorType||"xmlhttprequest"===t.initiatorType&&performanceSelfNameRe.test(t.name)||(n=s(t))&&o.event({event:{type:"resource-performance",timestamp:e},resource:n})})}}function s(e){var t=e.duration,n={type:e.initiatorType,duration:t,endtime:e.startTime+t};if(isNumber(t)&&isFinite(t)&&t>=0)return each(performanceFields,function(t){n[t.toLowerCase()]=e[t]}),n}function c(e){var t=[];return isArray(e)?t=flatMap(e,c):isString(e)?/^(?:link|script|css|img|iframe|xmlhttprequest)$/.test(e)?each(n,function(n){n.initiatorType===e&&t.push(n)}):each(n,function(n){~(""+n.name).indexOf(e)&&t.push(n)}):e instanceof RegExp?each(n,function(n){e.test(n.name)&&t.push(n)}):t=toArray(n),t}}isFunction(performance.getEntriesByType)&&onLoad(win,preparePerformanceEvents);var redirectUrl="https://"+getApiUrl()+"/v1/cm?sas_uid=[sas_uid]&stream=",AVAILABLE_SERVICES={smartadserver:"//sync.smartadserver.com/getuid?url="},FALLBACK_SERVICE="smartadserver";function getServiceUrl(e){return AVAILABLE_SERVICES[e]+encodeURIComponent(redirectUrl)}function loadSASIDRequestScript(e,t){for(var n=0;n<t.length;n++)appendHead(makeScriptNode(getServiceUrl(t[n])+e))}function isServiceAvailable(e){return e&&AVAILABLE_SERVICES[e]}function getCookieMatchingServices(e){var t=[],n=e.usermatching,i=e.cookie_matching,r=isString(n)?n.split(/,\s*/):isArray(n)?n:[];i&&t.push(FALLBACK_SERVICE);for(var a=0;a<r.length;a++)isServiceAvailable(r[a])&&-1===t.indexOf(r[a])&&t.push(r[a]);return t}void 0!==ns.forEachStream&&(ns.forEachStream(function(e){var t=getCookieMatchingServices(ns.options(e));if(t.length&&window.localStorage){var n=window.localStorage;n.getItem("deep_sas_uid")?(6048e5<Date.now()-n.getItem("deep_sas_uid_timestamp")&&loadSASIDRequestScript(e,t),ns.getTracker(e)({"user.id.sas_uid":n.getItem("deep_sas_uid")})):loadSASIDRequestScript(e,t)}}),window.deepTracker.initialize())}();